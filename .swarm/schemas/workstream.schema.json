{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "workstream.schema.json",
  "title": "Workstream Registry Schema",
  "description": "Schema for the workstream tracking system registry",
  "type": "object",
  "properties": {
    "version": {
      "type": "integer",
      "const": 2,
      "description": "Schema version"
    },
    "lastUpdated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last registry update"
    },
    "workstreams": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/workstream"
      },
      "description": "Map of workstream ID to workstream object"
    }
  },
  "required": ["version", "lastUpdated", "workstreams"],
  "definitions": {
    "workstream": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9-]+(/[a-z0-9-]+)*$",
          "description": "Hierarchical ID (e.g., 'feature-name' or 'feature-name/phase-1')"
        },
        "title": {
          "type": "string",
          "description": "Human-readable title"
        },
        "type": {
          "type": "string",
          "enum": ["epic", "feature", "phase", "task", "bug"],
          "description": "Type of workstream"
        },
        "state": {
          "type": "string",
          "enum": ["idea", "research", "planning", "sub_planning", "ready", "implementing", "merged"],
          "description": "Current lifecycle state"
        },
        "parent": {
          "type": ["string", "null"],
          "description": "Parent workstream ID for hierarchical relationships"
        },
        "priority": {
          "type": "integer",
          "minimum": 1,
          "maximum": 5,
          "description": "Priority level (1=highest, 5=lowest)"
        },
        "created": {
          "type": "string",
          "format": "date",
          "description": "Creation date (YYYY-MM-DD)"
        },
        "updated": {
          "type": "string",
          "format": "date-time",
          "description": "Last update timestamp"
        },
        "description": {
          "type": ["string", "null"],
          "description": "Optional longer description"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/dependency"
          },
          "description": "List of dependencies on other workstreams"
        },
        "artifacts": {
          "$ref": "#/definitions/artifacts",
          "description": "Links to related artifact files"
        },
        "implementation": {
          "$ref": "#/definitions/implementation",
          "description": "Implementation tracking details"
        },
        "children": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Child workstream IDs"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Categorization tags"
        },
        "notes": {
          "type": ["string", "null"],
          "description": "Additional context or notes"
        },
        "mergedAt": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Timestamp when workstream was merged"
        }
      },
      "required": ["id", "title", "type", "state", "priority", "created", "updated"],
      "additionalProperties": false
    },
    "dependency": {
      "type": "object",
      "properties": {
        "target": {
          "type": "string",
          "description": "ID of the workstream this depends on"
        },
        "type": {
          "type": "string",
          "enum": ["blocks", "informs", "conflicts"],
          "description": "Type of dependency relationship"
        },
        "reason": {
          "type": ["string", "null"],
          "description": "Explanation for the dependency"
        }
      },
      "required": ["target", "type"],
      "additionalProperties": false
    },
    "artifacts": {
      "type": "object",
      "properties": {
        "research": {
          "type": ["string", "null"],
          "description": "Path to research document"
        },
        "plan": {
          "type": ["string", "null"],
          "description": "Path to plan document"
        },
        "validation": {
          "type": ["string", "null"],
          "description": "Path to validation document"
        },
        "review": {
          "type": ["string", "null"],
          "description": "Path to review document"
        },
        "checkpoints": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Paths to checkpoint documents"
        }
      },
      "additionalProperties": false
    },
    "implementation": {
      "type": "object",
      "properties": {
        "branch": {
          "type": ["string", "null"],
          "description": "Git branch name"
        },
        "worktree": {
          "type": ["string", "null"],
          "description": "Path to git worktree"
        },
        "assignedInstance": {
          "type": ["string", "null"],
          "description": "Session ID of assigned Claude instance"
        },
        "currentPhase": {
          "type": ["integer", "null"],
          "description": "Current implementation phase number"
        },
        "totalPhases": {
          "type": ["integer", "null"],
          "description": "Total number of phases"
        }
      },
      "additionalProperties": false
    }
  }
}
